# FishGo: ë¬¼ê³ ê¸° Classification ì•± ê°œë°œ

## í”„ë¡œì íŠ¸ ì •ë³´
- ìœ„ì¹˜: /Users/young/project/navigo/fishgo
- ê¸°ì¡´ ì½”ë“œ ì°¸ì¡°: í˜„ì¬ YOLOv8n Detection êµ¬í˜„ë˜ì–´ ìˆìŒ
- CLAUDE.md íŒŒì¼ í™•ì¸í•  ê²ƒ

## ëª©í‘œ
ì–´ë¶€/ê²½ë§¤ì¥ì—ì„œ ë¬¼ê³ ê¸° ì¢…ë¥˜ë¥¼ ì •í™•í•˜ê²Œ ì‹ë³„í•˜ëŠ” ì•±
- ì‹¤ì‹œê°„ Detection â†’ **ì´¬ì˜ í›„ Classification** ë°©ì‹ìœ¼ë¡œ ì „í™˜
- ì •í™•ë„ ìš°ì„  (1~2ì´ˆ ì†Œìš” í—ˆìš©)
- ì˜¤í”„ë¼ì¸ ë™ì‘, ì €ê°€ ì•ˆë“œë¡œì´ë“œ ì§€ì›

## ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤
1. ì‚¬ìš©ìê°€ ë¬¼ê³ ê¸°ë¥¼ ê°€ì´ë“œ í”„ë ˆì„ ì•ˆì— ë§ì¶¤
2. "ì´¬ì˜í•˜ê¸°" ë²„íŠ¼ í´ë¦­
3. 1~2ì´ˆ ë¶„ì„ í›„ ê²°ê³¼ í™”ë©´ í‘œì‹œ
4. ì–´ì¢…ëª…(ì¸ë„ë„¤ì‹œì•„ì–´) + ì‹ ë¢°ë„ í‘œì‹œ

---

## Phase 1: Python - Classification ëª¨ë¸ ì¤€ë¹„

### 1.1 ë°ì´í„°ì…‹ ì¤€ë¹„ ìŠ¤í¬ë¦½íŠ¸
```python
# ìœ„ì¹˜: scripts/prepare_classification_data.py

"""
ê¸°ì¡´ Roboflow Object Detection ë°ì´í„°ì…‹ì—ì„œ
Classificationìš© ë°ì´í„°ì…‹ ìƒì„±

- Detection ë°ì´í„°ì˜ ê° BBoxë¥¼ cropí•˜ì—¬ ê°œë³„ ì´ë¯¸ì§€ë¡œ ì €ì¥
- í´ë˜ìŠ¤ë³„ í´ë” êµ¬ì¡°ë¡œ ì •ë¦¬
- Train/Val/Test ë¶„í•  ìœ ì§€
"""

import os
from pathlib import Path

def crop_detections_to_classification(
    detection_dataset_path: str,  # Roboflowì—ì„œ ë‹¤ìš´ë¡œë“œí•œ YOLO format
    output_path: str,
    target_size: tuple = (224, 224)  # Classification input size
):
    """
    Detection annotationì—ì„œ ê° bboxë¥¼ cropí•˜ì—¬
    classification ë°ì´í„°ì…‹ìœ¼ë¡œ ë³€í™˜

    Output êµ¬ì¡°:
    output_path/
    â”œâ”€â”€ train/
    â”‚   â”œâ”€â”€ Katsuwonus_Pelamis/
    â”‚   â”œâ”€â”€ Euthynnus_Affinis/
    â”‚   â””â”€â”€ ...
    â”œâ”€â”€ val/
    â””â”€â”€ test/
    """
    pass

# 19ì¢… í´ë˜ìŠ¤ ë§¤í•‘ (ê¸°ì¡´ labels.txt ê¸°ë°˜)
CLASS_NAMES = [
    "Alepes Djedaba",
    "Atropus Atropos",
    "Caranx Ignobilis",
    "Chanos Chanos",
    "Decapterus Macarellus",
    "Euthynnus Affinis",
    "Katsuwonus Pelamis",
    "Lutjanus Malabaricus",
    "Parastromateus Niger",
    "Rastrelliger Kanagurta",
    "Rastrelliger sp",
    "Scaridae",
    "Scomber Japonicus",
    "Scomberomorus Guttatus",
    "Thunnus Alalunga",
    "Thunnus Obesus",
    "Thunnus Tonggol",
    "Tribus Sardini",
    "Upeneus Moluccensis"
]

# ì¸ë„ë„¤ì‹œì•„ì–´ ì´ë¦„ ë§¤í•‘
INDONESIAN_NAMES = {
    "Alepes Djedaba": "Selar Bulat",
    "Atropus Atropos": "Cipa-Cipa",
    "Caranx Ignobilis": "Kuwe",
    "Chanos Chanos": "Bandeng",
    "Decapterus Macarellus": "Malalugis",
    "Euthynnus Affinis": "Tongkol",
    "Katsuwonus Pelamis": "Cakalang",
    "Lutjanus Malabaricus": "Kakap Merah",
    "Parastromateus Niger": "Bawal Hitam",
    "Rastrelliger Kanagurta": "Kembung",
    "Rastrelliger sp": "Kembung Banjar",
    "Scaridae": "Kakatua",
    "Scomber Japonicus": "Salem",
    "Scomberomorus Guttatus": "Tenggiri Papan",
    "Thunnus Alalunga": "Albacore Tuna",
    "Thunnus Obesus": "Tuna Mata Besar",
    "Thunnus Tonggol": "Tuna",
    "Tribus Sardini": "Kenyar",
    "Upeneus Moluccensis": "Kuniran"
}
```

### 1.2 ëª¨ë¸ í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸
```python
# ìœ„ì¹˜: scripts/train_classifier.py

"""
ì •í™•ë„ ìš°ì„  Classification ëª¨ë¸ í•™ìŠµ
- Base: EfficientNet-B0 (MobileNetV3ë³´ë‹¤ ì •í™•)
- Input: 224x224 (ì •ì‚¬ê°í˜•ìœ¼ë¡œ íŒ¨ë”©)
- 50+ epochs, early stopping
"""

import torch
import torch.nn as nn
from torchvision import models, transforms
from torch.utils.data import DataLoader
from torchvision.datasets import ImageFolder

# ì •í™•ë„ ìš°ì„ ì´ë¯€ë¡œ EfficientNet-B0 ì‚¬ìš© (MobileNetë³´ë‹¤ ì •í™•)
# ëª¨ë¸ í¬ê¸°: ~5MB (INT8 ì–‘ìí™” í›„ ~2MB)
def create_model(num_classes=19):
    model = models.efficientnet_b0(pretrained=True)
    model.classifier[1] = nn.Linear(model.classifier[1].in_features, num_classes)
    return model

# ë¬¼ê³ ê¸° ì´ë¯¸ì§€ íŠ¹í™” augmentation
train_transforms = transforms.Compose([
    transforms.Resize((256, 256)),
    transforms.RandomCrop(224),
    transforms.RandomHorizontalFlip(),  # ì¢Œìš° ë°˜ì „ë§Œ (ìƒí•˜ ë°˜ì „ì€ ë¹„í˜„ì‹¤ì )
    transforms.ColorJitter(brightness=0.3, contrast=0.3, saturation=0.2),  # ì¡°ëª… ë³€í™”
    transforms.ToTensor(),
    transforms.Normalize([0.485, 0.456, 0.406], [0.229, 0.224, 0.225])
])

val_transforms = transforms.Compose([
    transforms.Resize((224, 224)),
    transforms.ToTensor(),
    transforms.Normalize([0.485, 0.456, 0.406], [0.229, 0.224, 0.225])
])

def train(
    data_dir: str,
    output_dir: str,
    epochs: int = 50,
    batch_size: int = 32,
    learning_rate: float = 0.001
):
    """
    - Adam optimizer
    - ReduceLROnPlateau scheduler
    - Early stopping (patience=10)
    - Best model ì €ì¥
    """
    pass
```

### 1.3 TFLite ë³€í™˜ ìŠ¤í¬ë¦½íŠ¸
```python
# ìœ„ì¹˜: scripts/convert_to_tflite.py

"""
PyTorch â†’ ONNX â†’ TFLite ë³€í™˜
ì •í™•ë„ ìš°ì„ ì´ë¯€ë¡œ FP16 ì‚¬ìš© (INT8ë³´ë‹¤ ì •í™•)
"""

def convert_to_tflite(
    pytorch_model_path: str,
    output_path: str,
    input_size: tuple = (1, 3, 224, 224),
    quantization: str = "fp16"  # ì •í™•ë„ ìš°ì„ 
):
    """
    1. PyTorch â†’ ONNX
    2. ONNX â†’ TensorFlow SavedModel
    3. SavedModel â†’ TFLite (FP16)

    ì˜ˆìƒ ëª¨ë¸ í¬ê¸°: ~5MB
    """
    pass
```

---

## Phase 2: Android ì•± ê°œë°œ

### 2.1 í”„ë¡œì íŠ¸ êµ¬ì¡°
```
app/src/main/
â”œâ”€â”€ java/com/amigoinovasi/fishgo/
â”‚   â”œâ”€â”€ MainActivity.kt              # ì¹´ë©”ë¼ + ì´¬ì˜ í™”ë©´
â”‚   â”œâ”€â”€ ResultActivity.kt            # ê²°ê³¼ í‘œì‹œ í™”ë©´ (NEW)
â”‚   â”œâ”€â”€ classifier/                   # NEW íŒ¨í‚¤ì§€
â”‚   â”‚   â”œâ”€â”€ FishClassifier.kt        # TFLite ë¶„ë¥˜ê¸°
â”‚   â”‚   â””â”€â”€ ClassificationResult.kt  # ê²°ê³¼ ë°ì´í„° í´ë˜ìŠ¤
â”‚   â””â”€â”€ ui/
â”‚       â””â”€â”€ FishGuideOverlay.kt      # ê°€ì´ë“œ í”„ë ˆì„ (NEW)
â”œâ”€â”€ assets/model/
â”‚   â”œâ”€â”€ fish_classifier.tflite       # ìƒˆ ë¶„ë¥˜ ëª¨ë¸
â”‚   â””â”€â”€ labels.txt                   # í´ë˜ìŠ¤ + ì¸ë„ë„¤ì‹œì•„ì–´ ì´ë¦„
â””â”€â”€ res/
    â”œâ”€â”€ layout/
    â”‚   â”œâ”€â”€ activity_main.xml        # ì¹´ë©”ë¼ í™”ë©´
    â”‚   â””â”€â”€ activity_result.xml      # ê²°ê³¼ í™”ë©´ (NEW)
    â””â”€â”€ values/
        â””â”€â”€ strings.xml              # ì¸ë„ë„¤ì‹œì•„ì–´ ë¬¸ìì—´
```

### 2.2 MainActivity.kt (ì¹´ë©”ë¼ + ì´¬ì˜)
```kotlin
// ìœ„ì¹˜: app/src/main/java/com/amigoinovasi/fishgo/MainActivity.kt

class MainActivity : AppCompatActivity() {

    private lateinit var cameraExecutor: ExecutorService
    private lateinit var imageCapture: ImageCapture

    // ê°€ì´ë“œ í”„ë ˆì„ ë¹„ìœ¨: ê°€ë¡œë¡œ ê¸´ ë¬¼ê³ ê¸° í˜•íƒœ
    // 3:1 ë¹„ìœ¨ (ë„ˆë¹„:ë†’ì´) - í™”ë©´ ë„ˆë¹„ì˜ 80%
    private val GUIDE_ASPECT_RATIO = 3f / 1f
    private val GUIDE_WIDTH_PERCENT = 0.85f

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        setupCamera()
        setupCaptureButton()
    }

    private fun setupCamera() {
        // CameraX ì„¤ì •
        // - í›„ë©´ ì¹´ë©”ë¼
        // - Preview + ImageCapture UseCase
    }

    private fun setupCaptureButton() {
        binding.btnCapture.setOnClickListener {
            captureAndAnalyze()
        }
    }

    private fun captureAndAnalyze() {
        // 1. ë¡œë”© í‘œì‹œ
        showLoading(true)

        // 2. ì´ë¯¸ì§€ ìº¡ì²˜
        imageCapture.takePicture(
            ContextCompat.getMainExecutor(this),
            object : ImageCapture.OnImageCapturedCallback() {
                override fun onCaptureSuccess(image: ImageProxy) {
                    // 3. ê°€ì´ë“œ ì˜ì—­ë§Œ crop
                    val croppedBitmap = cropGuideRegion(image)

                    // 4. ResultActivityë¡œ ì „ë‹¬
                    val intent = Intent(this@MainActivity, ResultActivity::class.java)
                    // Bitmapì„ íŒŒì¼ë¡œ ì €ì¥ í›„ ê²½ë¡œ ì „ë‹¬
                    val imagePath = saveTempImage(croppedBitmap)
                    intent.putExtra("image_path", imagePath)
                    startActivity(intent)

                    showLoading(false)
                    image.close()
                }
            }
        )
    }

    /**
     * ì¹´ë©”ë¼ ì´ë¯¸ì§€ì—ì„œ ê°€ì´ë“œ í”„ë ˆì„ ì˜ì—­ë§Œ crop
     * ê°€ë¡œë¡œ ê¸´ ì˜ì—­ì„ ì •ì‚¬ê°í˜•ìœ¼ë¡œ íŒ¨ë”©í•˜ì—¬ ë°˜í™˜
     */
    private fun cropGuideRegion(image: ImageProxy): Bitmap {
        val bitmap = image.toBitmap()

        // ê°€ì´ë“œ ì˜ì—­ ê³„ì‚° (í™”ë©´ ì¤‘ì•™, 3:1 ë¹„ìœ¨)
        val guideWidth = (bitmap.width * GUIDE_WIDTH_PERCENT).toInt()
        val guideHeight = (guideWidth / GUIDE_ASPECT_RATIO).toInt()
        val left = (bitmap.width - guideWidth) / 2
        val top = (bitmap.height - guideHeight) / 2

        // Crop
        val cropped = Bitmap.createBitmap(bitmap, left, top, guideWidth, guideHeight)

        // ì •ì‚¬ê°í˜•ìœ¼ë¡œ íŒ¨ë”© (ë¶„ë¥˜ ëª¨ë¸ ì…ë ¥ìš©)
        return padToSquare(cropped, 224)
    }

    /**
     * ê°€ë¡œë¡œ ê¸´ ì´ë¯¸ì§€ë¥¼ ì •ì‚¬ê°í˜•ìœ¼ë¡œ íŒ¨ë”©
     * ìƒí•˜ì— ê²€ì •ìƒ‰ íŒ¨ë”© ì¶”ê°€
     */
    private fun padToSquare(bitmap: Bitmap, targetSize: Int): Bitmap {
        val maxDim = maxOf(bitmap.width, bitmap.height)
        val result = Bitmap.createBitmap(maxDim, maxDim, Bitmap.Config.ARGB_8888)
        val canvas = Canvas(result)
        canvas.drawColor(Color.BLACK)  // íŒ¨ë”© ìƒ‰ìƒ

        val left = (maxDim - bitmap.width) / 2f
        val top = (maxDim - bitmap.height) / 2f
        canvas.drawBitmap(bitmap, left, top, null)

        return Bitmap.createScaledBitmap(result, targetSize, targetSize, true)
    }
}
```

### 2.3 FishGuideOverlay.kt (ê°€ì´ë“œ í”„ë ˆì„)
```kotlin
// ìœ„ì¹˜: app/src/main/java/com/amigoinovasi/fishgo/ui/FishGuideOverlay.kt

/**
 * ë¬¼ê³ ê¸° ì´¬ì˜ ê°€ì´ë“œ ì˜¤ë²„ë ˆì´
 * - ê°€ë¡œë¡œ ê¸´ ì§ì‚¬ê°í˜• í”„ë ˆì„ (3:1 ë¹„ìœ¨)
 * - ëª¨ì„œë¦¬ê°€ ë‘¥ê·¼ í…Œë‘ë¦¬
 * - í”„ë ˆì„ ì™¸ë¶€ëŠ” ë°˜íˆ¬ëª… ì–´ë‘¡ê²Œ
 * - ê°€ì´ë“œ í…ìŠ¤íŠ¸ í‘œì‹œ
 */
class FishGuideOverlay @JvmOverloads constructor(
    context: Context,
    attrs: AttributeSet? = null
) : View(context, attrs) {

    private val framePaint = Paint().apply {
        color = Color.WHITE
        style = Paint.Style.STROKE
        strokeWidth = 4f
        pathEffect = DashPathEffect(floatArrayOf(20f, 10f), 0f)  // ì ì„ 
    }

    private val dimPaint = Paint().apply {
        color = Color.parseColor("#80000000")  // ë°˜íˆ¬ëª… ê²€ì •
        style = Paint.Style.FILL
    }

    private val textPaint = Paint().apply {
        color = Color.WHITE
        textSize = 40f
        textAlign = Paint.Align.CENTER
    }

    // ê°€ì´ë“œ í”„ë ˆì„ ë¹„ìœ¨
    private val aspectRatio = 3f / 1f  // ê°€ë¡œ:ì„¸ë¡œ = 3:1
    private val widthPercent = 0.85f

    private val guideRect = RectF()
    private val cornerRadius = 24f

    override fun onDraw(canvas: Canvas) {
        super.onDraw(canvas)

        // ê°€ì´ë“œ ì˜ì—­ ê³„ì‚°
        val guideWidth = width * widthPercent
        val guideHeight = guideWidth / aspectRatio
        val left = (width - guideWidth) / 2
        val top = (height - guideHeight) / 2
        guideRect.set(left, top, left + guideWidth, top + guideHeight)

        // 1. ì „ì²´ ì–´ë‘¡ê²Œ
        canvas.drawRect(0f, 0f, width.toFloat(), height.toFloat(), dimPaint)

        // 2. ê°€ì´ë“œ ì˜ì—­ íˆ¬ëª…í•˜ê²Œ (êµ¬ë© ëš«ê¸°)
        canvas.save()
        canvas.clipOutRect(guideRect)  // API 26+
        canvas.drawRect(guideRect, Paint().apply {
            xfermode = PorterDuffXfermode(PorterDuff.Mode.CLEAR)
        })
        canvas.restore()

        // 3. ê°€ì´ë“œ í”„ë ˆì„ í…Œë‘ë¦¬
        canvas.drawRoundRect(guideRect, cornerRadius, cornerRadius, framePaint)

        // 4. ë¬¼ê³ ê¸° ì•„ì´ì½˜ + ê°€ì´ë“œ í…ìŠ¤íŠ¸
        val fishIcon = "ğŸŸ"
        val guideText = "Letakkan ikan di dalam kotak"  // "ë¬¼ê³ ê¸°ë¥¼ ë°•ìŠ¤ ì•ˆì— ë†“ìœ¼ì„¸ìš”"

        canvas.drawText(fishIcon, width / 2f, guideRect.top - 60f, textPaint)
        canvas.drawText(guideText, width / 2f, guideRect.bottom + 80f, textPaint)
    }
}
```

### 2.4 ResultActivity.kt (ê²°ê³¼ í™”ë©´)
```kotlin
// ìœ„ì¹˜: app/src/main/java/com/amigoinovasi/fishgo/ResultActivity.kt

class ResultActivity : AppCompatActivity() {

    private lateinit var classifier: FishClassifier
    private lateinit var binding: ActivityResultBinding

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityResultBinding.inflate(layoutInflater)
        setContentView(binding.root)

        classifier = FishClassifier(this)

        val imagePath = intent.getStringExtra("image_path")
        if (imagePath != null) {
            analyzeImage(imagePath)
        }

        setupButtons()
    }

    private fun analyzeImage(imagePath: String) {
        // ë¡œë”© í‘œì‹œ
        binding.progressBar.visibility = View.VISIBLE
        binding.resultCard.visibility = View.GONE

        lifecycleScope.launch(Dispatchers.Default) {
            val bitmap = BitmapFactory.decodeFile(imagePath)

            // ë¶„ë¥˜ ìˆ˜í–‰ (1~2ì´ˆ ì†Œìš” ê°€ëŠ¥)
            val result = classifier.classify(bitmap)

            withContext(Dispatchers.Main) {
                displayResult(bitmap, result)
            }
        }
    }

    private fun displayResult(bitmap: Bitmap, result: ClassificationResult) {
        binding.progressBar.visibility = View.GONE
        binding.resultCard.visibility = View.VISIBLE

        // ì´¬ì˜ëœ ì´ë¯¸ì§€ í‘œì‹œ
        binding.ivCapturedFish.setImageBitmap(bitmap)

        // ê²°ê³¼ í‘œì‹œ
        binding.tvScientificName.text = result.scientificName
        binding.tvIndonesianName.text = result.indonesianName
        binding.tvConfidence.text = "${(result.confidence * 100).toInt()}%"
        binding.progressConfidence.progress = (result.confidence * 100).toInt()

        // ì‹ ë¢°ë„ì— ë”°ë¥¸ ìƒ‰ìƒ
        val confidenceColor = when {
            result.confidence >= 0.8f -> Color.parseColor("#4CAF50")  // ì´ˆë¡
            result.confidence >= 0.6f -> Color.parseColor("#FF9800")  // ì£¼í™©
            else -> Color.parseColor("#F44336")  // ë¹¨ê°•
        }
        binding.progressConfidence.setIndicatorColor(confidenceColor)

        // ë‚®ì€ ì‹ ë¢°ë„ ê²½ê³ 
        if (result.confidence < 0.6f) {
            binding.tvWarning.visibility = View.VISIBLE
            binding.tvWarning.text = "Hasil tidak pasti. Coba foto ulang."
            // "ê²°ê³¼ê°€ í™•ì‹¤í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì´¬ì˜í•´ë³´ì„¸ìš”."
        }
    }

    private fun setupButtons() {
        binding.btnRetake.setOnClickListener {
            finish()  // ì¹´ë©”ë¼ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
        }

        binding.btnSave.setOnClickListener {
            // TODO: ê²°ê³¼ ì €ì¥ ê¸°ëŠ¥ (Phase 2)
            Toast.makeText(this, "Tersimpan!", Toast.LENGTH_SHORT).show()
        }
    }

    override fun onDestroy() {
        super.onDestroy()
        classifier.close()
    }
}
```

### 2.5 FishClassifier.kt (TFLite ë¶„ë¥˜ê¸°)
```kotlin
// ìœ„ì¹˜: app/src/main/java/com/amigoinovasi/fishgo/classifier/FishClassifier.kt

/**
 * TFLite ê¸°ë°˜ ë¬¼ê³ ê¸° ë¶„ë¥˜ê¸°
 * - ì •í™•ë„ ìš°ì„  ì„¤ì •
 * - CPU ì‚¬ìš© (í˜¸í™˜ì„±)
 * - 1~2ì´ˆ ì†Œìš” í—ˆìš©
 */
class FishClassifier(private val context: Context) {

    private val interpreter: Interpreter
    private val labels: List<FishLabel>

    private val inputSize = 224
    private val numClasses = 19

    init {
        // ëª¨ë¸ ë¡œë“œ
        val modelBuffer = loadModelFile("model/fish_classifier.tflite")

        // ì •í™•ë„ ìš°ì„  ì˜µì…˜
        val options = Interpreter.Options().apply {
            setNumThreads(4)  // ë©€í‹°ìŠ¤ë ˆë“œ
            // GPU delegate ë¯¸ì‚¬ìš© (í˜¸í™˜ì„± + ì •í™•ë„)
        }

        interpreter = Interpreter(modelBuffer, options)
        labels = loadLabels("model/labels.txt")
    }

    /**
     * ì´ë¯¸ì§€ ë¶„ë¥˜ ìˆ˜í–‰
     * @param bitmap 224x224 ì •ì‚¬ê°í˜•ìœ¼ë¡œ ì „ì²˜ë¦¬ëœ ì´ë¯¸ì§€
     * @return ë¶„ë¥˜ ê²°ê³¼ (í´ë˜ìŠ¤ëª…, ì¸ë„ë„¤ì‹œì•„ëª…, ì‹ ë¢°ë„)
     */
    fun classify(bitmap: Bitmap): ClassificationResult {
        // 1. ì´ë¯¸ì§€ ì „ì²˜ë¦¬
        val inputBuffer = preprocessImage(bitmap)

        // 2. ì¶œë ¥ ë²„í¼ ì¤€ë¹„
        val outputBuffer = Array(1) { FloatArray(numClasses) }

        // 3. ì¶”ë¡  ì‹¤í–‰
        interpreter.run(inputBuffer, outputBuffer)

        // 4. ê²°ê³¼ íŒŒì‹± (softmax ì ìš©ë¨)
        val probabilities = outputBuffer[0]
        val maxIndex = probabilities.indices.maxByOrNull { probabilities[it] } ?: 0
        val confidence = probabilities[maxIndex]

        val label = labels[maxIndex]

        return ClassificationResult(
            scientificName = label.scientificName,
            indonesianName = label.indonesianName,
            confidence = confidence
        )
    }

    /**
     * ì´ë¯¸ì§€ ì „ì²˜ë¦¬
     * - RGB ì •ê·œí™”: (pixel / 255.0 - mean) / std
     * - ImageNet ê¸°ì¤€ mean/std ì‚¬ìš©
     */
    private fun preprocessImage(bitmap: Bitmap): ByteBuffer {
        val inputBuffer = ByteBuffer.allocateDirect(1 * inputSize * inputSize * 3 * 4)
        inputBuffer.order(ByteOrder.nativeOrder())

        val resized = Bitmap.createScaledBitmap(bitmap, inputSize, inputSize, true)
        val pixels = IntArray(inputSize * inputSize)
        resized.getPixels(pixels, 0, inputSize, 0, 0, inputSize, inputSize)

        // ImageNet normalization
        val mean = floatArrayOf(0.485f, 0.456f, 0.406f)
        val std = floatArrayOf(0.229f, 0.224f, 0.225f)

        for (pixel in pixels) {
            val r = ((pixel shr 16 and 0xFF) / 255.0f - mean[0]) / std[0]
            val g = ((pixel shr 8 and 0xFF) / 255.0f - mean[1]) / std[1]
            val b = ((pixel and 0xFF) / 255.0f - mean[2]) / std[2]

            inputBuffer.putFloat(r)
            inputBuffer.putFloat(g)
            inputBuffer.putFloat(b)
        }

        inputBuffer.rewind()
        return inputBuffer
    }

    private fun loadModelFile(filename: String): ByteBuffer {
        val assetFileDescriptor = context.assets.openFd(filename)
        val inputStream = FileInputStream(assetFileDescriptor.fileDescriptor)
        val fileChannel = inputStream.channel
        val startOffset = assetFileDescriptor.startOffset
        val declaredLength = assetFileDescriptor.declaredLength
        return fileChannel.map(FileChannel.MapMode.READ_ONLY, startOffset, declaredLength)
    }

    private fun loadLabels(filename: String): List<FishLabel> {
        // labels.txt í˜•ì‹: "scientific_name,indonesian_name"
        return context.assets.open(filename).bufferedReader().readLines().map { line ->
            val parts = line.split(",")
            FishLabel(parts[0].trim(), parts[1].trim())
        }
    }

    fun close() {
        interpreter.close()
    }
}

data class FishLabel(
    val scientificName: String,
    val indonesianName: String
)

data class ClassificationResult(
    val scientificName: String,
    val indonesianName: String,
    val confidence: Float
)
```

### 2.6 ë ˆì´ì•„ì›ƒ XML
```xml
<!-- res/layout/activity_main.xml -->
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@android:color/black">

    <!-- ì¹´ë©”ë¼ í”„ë¦¬ë·° -->
    <androidx.camera.view.PreviewView
        android:id="@+id/previewView"
        android:layout_width="match_parent"
        android:layout_height="match_parent" />

    <!-- ë¬¼ê³ ê¸° ê°€ì´ë“œ ì˜¤ë²„ë ˆì´ -->
    <com.amigoinovasi.fishgo.ui.FishGuideOverlay
        android:id="@+id/guideOverlay"
        android:layout_width="match_parent"
        android:layout_height="match_parent" />

    <!-- ì´¬ì˜ ë²„íŠ¼ -->
    <com.google.android.material.floatingactionbutton.FloatingActionButton
        android:id="@+id/btnCapture"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_marginBottom="48dp"
        android:src="@drawable/ic_camera"
        android:contentDescription="Ambil Foto"
        app:fabSize="large"
        app:backgroundTint="@color/white"
        app:tint="@color/black"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent" />

    <!-- ë¡œë”© ì¸ë””ì¼€ì´í„° -->
    <ProgressBar
        android:id="@+id/progressLoading"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:visibility="gone"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent" />

</androidx.constraintlayout.widget.ConstraintLayout>
```
```xml
<!-- res/layout/activity_result.xml -->
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:padding="16dp"
    android:background="@color/background_dark">

    <!-- ì´¬ì˜ëœ ì´ë¯¸ì§€ -->
    <com.google.android.material.card.MaterialCardView
        android:id="@+id/cardImage"
        android:layout_width="match_parent"
        android:layout_height="0dp"
        app:cardCornerRadius="16dp"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintHeight_percent="0.4">

        <ImageView
            android:id="@+id/ivCapturedFish"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:scaleType="centerCrop" />
    </com.google.android.material.card.MaterialCardView>

    <!-- ê²°ê³¼ ì¹´ë“œ -->
    <com.google.android.material.card.MaterialCardView
        android:id="@+id/resultCard"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginTop="16dp"
        app:cardCornerRadius="16dp"
        app:cardBackgroundColor="@color/card_background"
        app:layout_constraintTop_toBottomOf="@id/cardImage">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:padding="24dp">

            <!-- ë¬¼ê³ ê¸° ì•„ì´ì½˜ -->
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center"
                android:text="ğŸŸ"
                android:textSize="48sp" />

            <!-- ì¸ë„ë„¤ì‹œì•„ì–´ ì´ë¦„ (í¬ê²Œ) -->
            <TextView
                android:id="@+id/tvIndonesianName"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center"
                android:layout_marginTop="8dp"
                android:textSize="28sp"
                android:textStyle="bold"
                android:textColor="@color/text_primary"
                android:text="Tongkol" />

            <!-- í•™ëª… (ì‘ê²Œ) -->
            <TextView
                android:id="@+id/tvScientificName"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center"
                android:textSize="16sp"
                android:textStyle="italic"
                android:textColor="@color/text_secondary"
                android:text="Euthynnus Affinis" />

            <!-- ì‹ ë¢°ë„ -->
            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="24dp"
                android:orientation="vertical">

                <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="Akurasi"
                    android:textColor="@color/text_secondary" />

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:orientation="horizontal"
                    android:gravity="center_vertical">

                    <com.google.android.material.progressindicator.LinearProgressIndicator
                        android:id="@+id/progressConfidence"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        app:trackThickness="12dp"
                        app:trackCornerRadius="6dp" />

                    <TextView
                        android:id="@+id/tvConfidence"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_marginStart="16dp"
                        android:textSize="24sp"
                        android:textStyle="bold"
                        android:text="94%" />
                </LinearLayout>
            </LinearLayout>

            <!-- ê²½ê³  ë©”ì‹œì§€ -->
            <TextView
                android:id="@+id/tvWarning"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center"
                android:layout_marginTop="16dp"
                android:textColor="@color/warning"
                android:visibility="gone" />

        </LinearLayout>
    </com.google.android.material.card.MaterialCardView>

    <!-- ë¡œë”© -->
    <ProgressBar
        android:id="@+id/progressBar"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        app:layout_constraintTop_toBottomOf="@id/cardImage"
        app:layout_constraintBottom_toTopOf="@id/btnRetake"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent" />

    <!-- ë²„íŠ¼ë“¤ -->
    <com.google.android.material.button.MaterialButton
        android:id="@+id/btnRetake"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginEnd="8dp"
        android:text="Foto Ulang"
        style="@style/Widget.Material3.Button.OutlinedButton"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toStartOf="@id/btnSave"
        app:layout_constraintWidth_percent="0.45" />

    <com.google.android.material.button.MaterialButton
        android:id="@+id/btnSave"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginStart="8dp"
        android:text="Simpan"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintStart_toEndOf="@id/btnRetake"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintWidth_percent="0.45" />

</androidx.constraintlayout.widget.ConstraintLayout>
```

---

## Phase 3: ë¬¸ì„œ ì—…ë°ì´íŠ¸

### docs/model.md ì—…ë°ì´íŠ¸ ë‚´ìš©
```markdown
## Model Overview (v2 - Classification)

| í•­ëª© | ê°’ |
|------|------|
| Architecture | EfficientNet-B0 |
| Task | Image Classification |
| Export Format | TFLite FP16 |
| File Size | ~5 MB |
| Input Size | 224 x 224 x 3 (RGB) |
| Output Shape | [1, 19] (softmax) |
| Classes | 19 ì¢… |
| Inference Time | ~1.5ì´ˆ (ì €ê°€í° ê¸°ì¤€) |

## ì´ì „ ë²„ì „ê³¼ ë¹„êµ

| í•­ëª© | v1 (Detection) | v2 (Classification) |
|------|----------------|---------------------|
| ëª¨ë¸ | YOLOv8n | EfficientNet-B0 |
| í¬ê¸° | 6.2 MB | ~5 MB |
| ì†ë„ | ~200ms | ~1.5ì´ˆ |
| ì •í™•ë„ | mAP50 59% | Top-1 Acc 85%+ |
| ì¶œë ¥ | ë‹¤ìˆ˜ BBox | ë‹¨ì¼ í´ë˜ìŠ¤ |
```

---

## ì œì•½ì‚¬í•­
- ê¸°ì¡´ 19ì¢… í´ë˜ìŠ¤ + ì¸ë„ë„¤ì‹œì•„ì–´ ì´ë¦„ ìœ ì§€
- Android SDK 24+ í˜¸í™˜
- ì˜¤í”„ë¼ì¸ ë™ì‘ í•„ìˆ˜
- ì €ê°€í° (RAM 2GB, ì €ì‚¬ì–‘ CPU) ëŒ€ì‘
- ì •í™•ë„ ìš°ì„  (ì†ë„ëŠ” 1~2ì´ˆ í—ˆìš©)

## í…ŒìŠ¤íŠ¸ ê¸°ì¤€
- [ ] ëª¨ë¸ í¬ê¸° 5MB ì´í•˜
- [ ] Top-1 ì •í™•ë„ 85% ì´ìƒ
- [ ] ì¶”ë¡  ì‹œê°„ 2ì´ˆ ì´ë‚´ (Galaxy A03 ê¸°ì¤€)
- [ ] ê°€ì´ë“œ í”„ë ˆì„ UI ì§ê´€ì 
- [ ] ì¸ë„ë„¤ì‹œì•„ì–´ UI ì™„ì„±ë„
